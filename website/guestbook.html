<!DOCTYPE html>
<html>
<head>
  <title>Chilled Cat Guestbook</title>
  <style>
    body {
      font-family: "Comic Sans MS", cursive, sans-serif;
      background: #f0f8ff url("files/images/chilled_cat_flex.webp") repeat;
      text-align: center;
      padding: 20px;
    }
h1 {
  font-size: 2.5em;
  font-weight: bold;
  color: #fff; /* white text */
  background: linear-gradient(to right, #007bff, #00bcd4); /* nice blue gradient */
  display: inline-block; /* shrink background to fit text */
  padding: 10px 20px; /* breathing room */
  border-radius: 8px; /* smooth corners */
  box-shadow: 0 4px 10px rgba(0,0,0,0.3); /* slight shadow for depth */
}

    .form-wrapper {
      max-width: 700px;
      margin: 0 auto;
      border: 5px ridge #ff69b4;
      background: #fff;
      padding: 15px;
      box-shadow: 0 0 20px #ff69b4;
    }

p {
  font-size: 1.2em;
  color: #fff;
  background: linear-gradient(to right, #007bff, #00bcd4);
  display: inline-block;
  padding: 6px 14px;
  border-radius: 6px;
  box-shadow: 0 3px 8px rgba(0,0,0,0.25);
  margin-bottom: 20px;
}
  </style>
</head>
<body>
  <h1>üêæ Chilled Cat Guestbook üêæ</h1><br>
  <p>Leave your paw print below! üò∫</p>

  <div class="form-wrapper">
    <iframe src="https://docs.google.com/forms/d/e/1FAIpQLScjxtac9YVtbt6QjjfWEjCX83E62ShC-S0IB_DKjUd8xvZbfQ/viewform?embedded=true"
            width="100%" height="900" frameborder="0" marginheight="0" marginwidth="0">
      Loading‚Ä¶
    </iframe>
  </div>



<section class="guestbook-responses">
  <h2>üìñ Guestbook Responses</h2>
  <table id="guestbookTable">
    <thead>
      <tr>
        <th>Timestamp</th>
        <th>What's your telegram username?</th>
        <th>What is your message?</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<script>
// --- Config: your Spreadsheet + tab gid ---
const SHEET_ID = "1y6gSj-KZeNRZ8oJt5sDI8e1h3zdz2nyorMyT8V7p8o0";
const GID = "1773205551"; // responses tab

// Sanitize to prevent XSS
function sanitize(str = "") {
  const div = document.createElement("div");
  div.textContent = String(str);
  return div.innerHTML;
}

// JSONP callback Google will call
function handleGuestbook(resp) {
  try {
    const rows = resp?.table?.rows || [];
    const tbody = document.querySelector("#guestbookTable tbody");
    tbody.innerHTML = "";

    // newest first
    rows.slice().reverse().forEach(r => {
      const c = r.c || [];
      const timestamp = sanitize(c[0]?.f || c[0]?.v || "");
      const username  = sanitize(c[1]?.v || "");
      const message   = sanitize(c[2]?.v || "");

      if (!username && !message) return;

      let shortMsg = message;
      let truncated = false;
      const LIMIT = 150;
      if (message.length > LIMIT) {
        shortMsg = message.slice(0, LIMIT) + "...";
        truncated = true;
      }

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${timestamp}</td>
        <td>${username.startsWith("@") ? username : (username ? "@"+username : "")}</td>
        <td>
          <span class="msg-text">${shortMsg}</span>
          ${truncated ? `<button class="read-more">Read more</button>` : ""}
        </td>
      `;
      tbody.appendChild(tr);

      if (truncated) {
        const btn = tr.querySelector(".read-more");
        const span = tr.querySelector(".msg-text");
        btn.addEventListener("click", () => {
          if (btn.textContent === "Read more") {
            span.textContent = message;
            btn.textContent = "Show less";
          } else {
            span.textContent = message.slice(0, LIMIT) + "...";
            btn.textContent = "Read more";
          }
        });
      }
    });

    if (!rows.length) {
      document.querySelector("#guestbookTable tbody").innerHTML =
        `<tr><td colspan="3">No entries yet. Be the first to sign the guestbook!</td></tr>`;
    }
  } catch (e) {
    console.error(e);
    document.querySelector("#guestbookTable tbody").innerHTML =
      `<tr><td colspan="3">Guestbook is currently unavailable. Please try again later.</td></tr>`;
  }
}

// Inject the JSONP script (no CORS needed)
(function injectJSONP(){
  const script = document.createElement("script");
  // tqx: out:json + responseHandler=handleGuestbook
  script.src = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?gid=${GID}&tqx=out:json;responseHandler:handleGuestbook`;
  script.onerror = () => {
    document.querySelector("#guestbookTable tbody").innerHTML =
      `<tr><td colspan="3">Guestbook is currently unavailable. Please try again later.</td></tr>`;
  };
  document.head.appendChild(script);
})();
</script>

<style>
  .guestbook-responses { max-width: 900px; margin: 40px auto; text-align: center; }
  #guestbookTable { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 1em; background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
  #guestbookTable th, #guestbookTable td { padding: 12px 16px; border-bottom: 1px solid #ddd; text-align: left; vertical-align: top; }
  #guestbookTable th { background: #f9f9f9; font-weight: bold; color: #333; }
  #guestbookTable tr:hover { background: #f6f6f6; }
  .read-more { margin-left: 8px; padding: 4px 8px; font-size: 0.8em; cursor: pointer; border: none; background: #007bff; color: #fff; border-radius: 4px; }
  .read-more:hover { background: #0056b3; }
  @media (max-width: 600px){ #guestbookTable th, #guestbookTable td { padding: 8px 10px; font-size: 0.9em; } }

.guestbook-responses h2 {
  font-size: 2em;
  font-weight: bold;
  color: #fff;
  background: linear-gradient(to right, #007bff, #00bcd4);
  display: inline-block;
  padding: 8px 18px;
  border-radius: 8px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  margin-bottom: 20px;
}
</style>


</body>
</html>
