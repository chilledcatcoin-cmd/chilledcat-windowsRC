<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Personalize â€“ Windows RC</title>
<style>
  body {
    margin: 0;
    font-family: "MS Sans Serif", sans-serif;
    font-size: 13px;
    background: #c0c0c0;
    color: black;
  }

  .tabs {
    display: flex;
    border-bottom: 2px solid #808080;
    background: #d4d0c8;
    padding-top: 2px;
  }
  .tab {
    padding: 4px 10px;
    border: 2px outset #fff;
    background: #c0c0c0;
    cursor: pointer;
    margin-right: 4px;
  }
  .tab.active {
    border: 2px inset #808080;
    background: #dcdcdc;
  }

  .content {
    padding: 10px;
  }

  .section { display: none; }
  .section.active { display: block; }

  .preview {
    width: 160px;
    height: 100px;
    border: 2px inset #808080;
    background-size: cover;
    background-position: center;
    margin-top: 10px;
  }

  select, input[type=number] {
    font-family: "MS Sans Serif";
    font-size: 13px;
    margin-top: 4px;
  }

  .buttons {
    text-align: right;
    margin: 10px 10px 8px;
    border-top: 1px solid #808080;
    padding-top: 6px;
  }

  button {
    font-family: "MS Sans Serif";
    font-size: 13px;
    padding: 2px 8px;
    border: 2px outset #fff;
    background: #c0c0c0;
    cursor: pointer;
    margin-left: 6px;
  }
  button:active {
    border: 2px inset #808080;
  }
</style>
</head>
<body>

  <div class="tabs">
    <div class="tab active" data-tab="background">Background</div>
    <div class="tab" data-tab="colors">Colors</div>
    <div class="tab" data-tab="screensaver">Screen Saver</div>
  </div>

  <div class="content">
    <!-- Background -->
    <div id="background" class="section active">
      <b>Wallpaper:</b><br>
      <select id="wallpaper">
        <option value="./media/wallpaper.png">Default (Chillscape)</option>
        <option value="./media/wallpapers/chillblue.png">Chilled Blue</option>
        <option value="./media/wallpapers/paws.png">Paw Pattern</option>
        <option value="./media/wallpapers/nightcat.png">Midnight Cat</option>
      </select>

      <div class="preview" id="wallPreview"></div>
    </div>

    <!-- Colors -->
    <div id="colors" class="section">
      <b>Theme:</b><br>
      <select id="theme">
        <option value="classic">Classic Gray</option>
        <option value="lavender">Lavender Chill</option>
        <option value="midnight">Midnight Cat</option>
        <option value="mint">Minty Fresh</option>
      </select>

      <div class="preview" id="colorPreview"></div>
    </div>

    <!-- Screen Saver -->
    <div id="screensaver" class="section">
      <b>Screen Saver:</b><br>
      <select id="saver">
        <option value="none">None</option>
        <option value="./system/screensaver.html">Chilled Nebula</option>
        <option value="./system/screensaver_catdreams.html">Cat Dreams</option>
        <option value="./system/screensaver_stars.html">Starfield</option>
      </select>

      <div style="margin-top:8px;">
        Wait <input type="number" id="saverDelay" value="2" min="1" max="60" style="width:40px;"> minutes
      </div>
    </div>
  </div>

  <div class="buttons">
    <button onclick="applySettings()">Apply</button>
    <button onclick="cancel()">Cancel</button>
    <button onclick="testSaver()">Test</button>
  </div>

<script>
const tabs = document.querySelectorAll('.tab');
const sections = document.querySelectorAll('.section');

tabs.forEach(tab => {
  tab.addEventListener('click', () => {
    tabs.forEach(t => t.classList.remove('active'));
    sections.forEach(s => s.classList.remove('active'));
    tab.classList.add('active');
    document.getElementById(tab.dataset.tab).classList.add('active');
  });
});

const wallpaper = document.getElementById('wallpaper');
const theme = document.getElementById('theme');
const saver = document.getElementById('saver');
const saverDelay = document.getElementById('saverDelay');
const wallPreview = document.getElementById('wallPreview');
const colorPreview = document.getElementById('colorPreview');

// --- Preview updates ---
wallpaper.addEventListener('change', () => {
  wallPreview.style.backgroundImage = `url(${wallpaper.value})`;
});
theme.addEventListener('change', () => {
  const colors = getThemeColors(theme.value);
  colorPreview.style.background = colors.bg;
  colorPreview.style.border = `2px solid ${colors.hl}`;
});

// --- Apply + Cancel ---
function applySettings() {
  const data = {
    type: "updatePersonalization",
    wallpaper: wallpaper.value,
    theme: theme.value,
    saver: saver.value,
    saverDelay: parseInt(saverDelay.value)
  };
  window.top.postMessage(data, "*");
  localStorage.setItem("chilledTheme", JSON.stringify(data));
  alert("Settings applied!");
}

function cancel() {
  window.top.postMessage({ type: "closeWin", id: "personalize" }, "*");
}

function testSaver() {
  window.top.postMessage({ type: "testScreensaver" }, "*");
}

function getThemeColors(name) {
  switch (name) {
    case "lavender": return { bg:"#d8c0ff", hl:"#8060c0" };
    case "midnight": return { bg:"#1a1a2e", hl:"#000080" };
    case "mint":     return { bg:"#c0ffd8", hl:"#409060" };
    default:         return { bg:"#c0c0c0", hl:"#000080" };
  }
}

// --- Load saved theme ---
window.addEventListener("load", () => {
  const saved = JSON.parse(localStorage.getItem("chilledTheme") || "{}");
  if (saved.wallpaper) wallpaper.value = saved.wallpaper;
  if (saved.theme) theme.value = saved.theme;
  if (saved.saver) saver.value = saved.saver;
  if (saved.saverDelay) saverDelay.value = saved.saverDelay;
  wallPreview.style.backgroundImage = `url(${wallpaper.value})`;
  const colors = getThemeColors(theme.value);
  colorPreview.style.background = colors.bg;
  colorPreview.style.border = `2px solid ${colors.hl}`;
});
</script>
</body>
</html>
