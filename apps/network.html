<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dial-Up Networking ‚Äì ChillNet</title>
<style>
  body {
    margin: 0;
    font-family: "MS Sans Serif", sans-serif;
    background: #c0c0c0;
    color: #000;
    font-size: 13px;
    padding: 10px;
  }

  .cat-art {
    display: block;
    margin: 4px auto 10px auto;
    width: 72px;
    height: auto;
    image-rendering: pixelated;
  }

  .field { margin-bottom: 8px; }
  .field label { display: block; margin-bottom: 2px; font-size: 12px; color: #000080; }
  .field input, .field select {
    width: 100%;
    border: 1px solid #000;
    padding: 3px;
    font-family: "MS Sans Serif";
    font-size: 12px;
    background: #fff;
  }

  .checkbox {
    font-size: 12px;
    margin: 4px 0;
  }

  .buttons {
    display: flex;
    justify-content: space-between;
    margin-top: 10px;
  }

  button {
    font-family: "MS Sans Serif";
    font-size: 12px;
    padding: 2px 12px;
    border: 2px outset #c0c0c0;
    background: #c0c0c0;
    cursor: pointer;
    min-width: 80px;
  }

  button:active { border: 2px inset #808080; }

  .status {
    background: #e0e0e0;
    border-top: 2px solid #fff;
    border-left: 2px solid #fff;
    border-right: 2px solid #808080;
    border-bottom: 2px solid #808080;
    padding: 6px;
    margin-top: 12px;
    height: 50px;
    font-size: 12px;
    overflow: hidden;
  }

  .error {
    color: red;
    font-weight: bold;
  }
</style>
</head>
<body>
  <img src="../media/icons/chilledcat_phone.png" alt="Chilled Cat Phone" class="cat-art">

  <div class="field">
    <label>Username:</label>
    <input type="text" id="username" value="ChilledCat">
  </div>

  <div class="field">
    <label>Password:</label>
    <input type="password" id="password" value="meow123">
  </div>

  <div class="checkbox">
    <input type="checkbox" id="saveInfo" checked> Save username and password
  </div>

  <div class="field">
    <label>Dial number:</label>
    <select id="dialNumber">
      <option>1-800-CHILLED</option>
    </select>
  </div>

  <div class="buttons">
    <button id="connectBtn">Dial</button>
    <button id="cancelBtn">Cancel</button>
  </div>

  <div class="status" id="statusBox">Status: Not connected.</div>

  <audio id="dialup-audio" preload="auto">
    <source src="../media/dialup.mp3" type="audio/mpeg">
  </audio>

  <script>
    const connectBtn = document.getElementById("connectBtn");
    const cancelBtn = document.getElementById("cancelBtn");
    const statusBox = document.getElementById("statusBox");
    const dialupAudio = document.getElementById("dialup-audio");

    let connecting = false;
    let connected = localStorage.getItem("rc-online") === "true";
    let dialTimer = null;

    // Restore saved credentials
    document.getElementById("username").value = localStorage.getItem("rc-username") || "ChilledCat";
    document.getElementById("password").value = localStorage.getItem("rc-password") || "meow123";

    updateUI();

    function updateUI() {
      if (connected) {
        connectBtn.textContent = "Disconnect";
        statusBox.textContent = "Status: Connected to ChillNet.";
        cancelBtn.style.display = "none";
      } else {
        connectBtn.textContent = "Dial";
        statusBox.textContent = "Status: Not connected.";
        cancelBtn.style.display = "inline-block";
      }
    }

    connectBtn.addEventListener("click", () => {
      if (connected) disconnect();
      else startDial();
    });

    cancelBtn.addEventListener("click", () => {
      if (connecting) {
        stopDial("Connection canceled.");
      } else {
        window.top.postMessage({ type: "closeWin", id: "network" }, "*");
      }
    });

    function startDial() {
      connecting = true;
      connectBtn.disabled = true;
      cancelBtn.disabled = false;
      statusBox.textContent = "Status: Dialing attempt 1 of 5...";
      dialupAudio.currentTime = 0;
      dialupAudio.play().catch(()=>{});

      const steps = [
        "Dialing attempt 1 of 5...",
        "Dialing...",
        "Negotiating connection...",
        "Verifying username and password...",
        "Establishing connection...",
        "Connected!"
      ];

      let stepIndex = 0;
      const stepInterval = 28000 / steps.length;

      dialTimer = setInterval(() => {
        if (!connecting) return;

        statusBox.textContent = "Status: " + steps[stepIndex];

        // üß© When verifying credentials
        if (steps[stepIndex] === "Verifying username and password...") {
          const user = document.getElementById("username").value.trim();
          const pass = document.getElementById("password").value.trim();

          // ‚ùå Wrong credentials
          if (user !== "ChilledCat" || pass !== "meow123") {
            clearInterval(dialTimer);
            wrongCredentials();
            return;
          }
        }

        stepIndex++;
        if (stepIndex >= steps.length) {
          clearInterval(dialTimer);
          finishConnect();
        }
      }, stepInterval);
    }

    function wrongCredentials() {
      connecting = false;
      dialupAudio.pause();
      dialupAudio.currentTime = 0;
      connectBtn.disabled = false;
      statusBox.innerHTML = '<span class="error">‚ùå Wrong username or password.</span>';
    }

    function stopDial(message) {
      connecting = false;
      clearInterval(dialTimer);
      dialupAudio.pause();
      dialupAudio.currentTime = 0;
      connectBtn.disabled = false;
      statusBox.textContent = "Status: " + message;
      setTimeout(() => window.top.postMessage({ type: "closeWin", id: "network" }, "*"), 800);
    }

    function finishConnect() {
      connecting = false;
      connected = true;
      connectBtn.disabled = false;
      connectBtn.textContent = "Disconnect";
      statusBox.textContent = "Status: Connected to ChillNet.";
      cancelBtn.style.display = "none";
      localStorage.setItem("rc-online", "true");
      localStorage.setItem("rc-username", document.getElementById("username").value);
      localStorage.setItem("rc-password", document.getElementById("password").value);
      window.top.postMessage({ type: "connectNetwork" }, "*");
    }

    function disconnect() {
      connected = false;
      connecting = false;
      clearInterval(dialTimer);
      localStorage.setItem("rc-online", "false");
      statusBox.textContent = "Status: Disconnected.";
      connectBtn.textContent = "Dial";
      cancelBtn.style.display = "inline-block";
      window.top.postMessage({ type: "disconnectNetwork" }, "*");
    }
  </script>
</body>
</html>
