<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>My Computer — Windows RC</title>
<style>
  :root{
    --win-bg:#c0c0c0; --panel-bg:#dcdcdc; --border:#808080;
    --text:#000; --title:#000080; --highlight:#f1f7ff;
  }
  html,body{
    margin:0; height:100%;
    background:var(--win-bg);
    font-family:"MS Sans Serif",Tahoma,Arial;
    font-size:13px; color:var(--text);
    display:flex; flex-direction:column;
  }
  .toolbar{
    background:var(--panel-bg);
    border-bottom:2px solid var(--border);
    padding:4px; display:flex; gap:6px;
  }
  button.btn{
    font-family:inherit; font-size:12px;
    padding:3px 8px; background:#e0e0e0;
    border:2px outset #fff; cursor:pointer;
  }
  .content{
    flex:1; background:#fff; margin:6px;
    border:2px inset #fff; overflow:auto; padding:10px;
  }
  .item-grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
    gap:16px; justify-items:center;
  }
  .item{
    display:flex; flex-direction:column;
    align-items:center; gap:6px;
    padding:6px; cursor:pointer;
    border:1px solid transparent; border-radius:4px;
  }
  .item:hover{background:var(--highlight); border-color:#c9defe;}
  .thumb{width:48px;height:48px;image-rendering:pixelated;}
  .statusbar{
    background:var(--panel-bg);
    border-top:2px solid var(--border);
    padding:3px 8px; font-size:12px;
    display:flex; justify-content:space-between;
  }
</style>
</head>
<body>
  <!-- Hidden title element for script compatibility -->
  <span id="titleText" style="display:none"></span>

  <!-- Toolbar -->
  <div class="toolbar">
    <button class="btn" onclick="showDrives()">My Computer</button>
    <button class="btn" onclick="goUp()">Up</button>
    <button class="btn" onclick="openFind()">Find Files</button>
  </div>

  <!-- Main content area -->
  <div class="content" id="content"></div>
  <div class="statusbar" id="status"><span></span><span></span></div>

  <!-- Find window -->
  <iframe src="find.html" id="findWin"
          style="display:none;position:fixed;top:50%;left:50%;
                 transform:translate(-50%,-50%);
                 width:640px;height:480px;
                 border:2px solid #000;z-index:999;"></iframe>

<script>
const drives=[
  {label:"3½ Floppy (A:)", icon:"drive_floppy.png", path:"/media/mnt/floppy"},
  {label:"Local Disk (C:)", icon:"drive_hard.png",  path:"/media/mnt/harddrive"},
  {label:"CD-ROM (D:)",     icon:"drive_cd.png",    path:"/media/mnt/cd"}
];

let currentPath="/media/mnt";
const content=document.getElementById("content");
const status=document.getElementById("status");

function showDrives(){
  currentPath="/media/mnt";
  let html='<div class="item-grid">';
  for(const d of drives){
    html+=`
      <div class="item drive" data-path="${d.path}">
        <img class="thumb" src="../media/icons/${d.icon}">
        <div>${d.label}</div>
      </div>`;
  }
  html+='</div>';
  content.innerHTML=html;
  status.innerHTML=`<span>${drives.length} drives</span><span>My Computer</span>`;
  document.querySelectorAll(".item.drive").forEach(it=>{
    it.onclick=()=>openFolder(it.dataset.path);
  });
}

async function openFolder(path){
  currentPath=path;
  try{
    const res=await fetch(path);
    if(res.status===404){
      alert("Please insert a disk into "+path);
      return;
    }
  }catch{}

  const listing=await getFolderListing(path);
  let html='<div class="item-grid">';
  for(const item of listing){
    const icon=item.type==="folder"?"folder_1.png":"textfile.png";
    html+=`
      <div class="item" data-path="${item.path}" data-type="${item.type}">
        <img class="thumb" src="../media/icons/${icon}">
        <div>${item.name}</div>
      </div>`;
  }
  html+='</div>';
  content.innerHTML=html;
  status.innerHTML=`<span>${listing.length} items</span><span>${path}</span>`;
  document.querySelectorAll(".item").forEach(it=>{
    const p=it.dataset.path;
    const t=it.dataset.type;
    it.onclick=()=>{
      if(t==="folder") openFolder(p);
      else window.open(p,"_blank");
    };
  });
}

async function getFolderListing(path) {
  try {
    // Determine where this HTML is hosted
    const base = window.location.pathname
      .replace(/\/apps\/.*/, "")   // strip /apps/mycomputer.html
      .replace(/\/$/, "");         // remove trailing slash

    // Always fetch relative to the project base
    const rel = `${base}${encodeURI(path)}/index.json`;
    console.log("Fetching:", rel);

    const r = await fetch(rel, { cache: "no-store" });
    if (!r.ok) {
      console.warn("Index not found:", rel, r.status);
      return [];
    }

    const data = await r.json();
    console.log("Loaded listing:", data);
    return data;

  } catch (e) {
    console.warn("getFolderListing error:", e);
    return [];
  }
}




function goUp(){
  if(currentPath==="/media/mnt"){showDrives();return;}
  const parts=currentPath.split("/");
  parts.pop();
  const up=parts.join("/")||"/media/mnt";
  if(up==="/media/mnt") showDrives(); else openFolder(up);
}

function openFind(){
  const f=document.getElementById("findWin");
  f.style.display=f.style.display==="none"?"block":"none";
}

showDrives();
</script>
</body>
</html>
